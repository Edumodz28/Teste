local CombatFramework = require(game:GetService("Players").LocalPlayer.PlayerScripts:WaitForChild("CombatFramework"))
local CombatFrameworkR = getupvalues(CombatFramework)[2]
local RigController = require(game:GetService("Players")["LocalPlayer"].PlayerScripts.CombatFramework.RigController)
local RigControllerR = getupvalues(RigController)[2]
local realbhit = require(game.ReplicatedStorage.CombatFramework.RigLib)
local cooldownfastattack = tick()

-- Função para obter todos os inimigos próximos
function getAllBladeHits(Sizes)
    local Hits = {}
    local Client = game.Players.LocalPlayer
    local Enemies = game:GetService("Workspace").Enemies:GetChildren()
    for i = 1, #Enemies do
        local v = Enemies[i]
        local Human = v:FindFirstChildOfClass("Humanoid")
        if Human and Human.RootPart and Human.Health > 0 and Client:DistanceFromCharacter(Human.RootPart.Position) < Sizes + 5 then
            table.insert(Hits, Human.RootPart)
        end
    end
    return Hits
end

-- Função para obter a arma atual
function CurrentWeapon()
    local ac = CombatFrameworkR.activeController
    local ret = ac.blades[1]
    if not ret then return game.Players.LocalPlayer.Character:FindFirstChildOfClass("Tool").Name end
    pcall(function()
        while ret.Parent ~= game.Players.LocalPlayer.Character do ret = ret.Parent end
    end)
    if not ret then return game.Players.LocalPlayer.Character:FindFirstChildOfClass("Tool").Name end
    return ret
end

-- Função para realizar um ataque
function AttackFunction()
    local ac = CombatFrameworkR.activeController
    if ac and ac.equipped then
        for indexincrement = 1, 1 do
            local bladehit = getAllBladeHits(60)
            if #bladehit > 0 then
                local AcAttack8 = debug.getupvalue(ac.attack, 5)
                local AcAttack9 = debug.getupvalue(ac.attack, 6)
                local AcAttack7 = debug.getupvalue(ac.attack, 4)
                local AcAttack10 = debug.getupvalue(ac.attack, 7)
                local NumberAc12 = (AcAttack8 * 798405 + AcAttack7 * 727595) % AcAttack9
                local NumberAc13 = AcAttack7 * 798405
                (function()
                    NumberAc12 = (NumberAc12 * AcAttack9 + NumberAc13) % 1099511627776
                    AcAttack8 = math.floor(NumberAc12 / AcAttack9)
                    AcAttack7 = NumberAc12 - AcAttack8 * AcAttack9
                end)()
                AcAttack10 = AcAttack10 + 1
                debug.setupvalue(ac.attack, 5, AcAttack8)
                debug.setupvalue(ac.attack, 6, AcAttack9)
                debug.setupvalue(ac.attack, 4, AcAttack7)
                debug.setupvalue(ac.attack, 7, AcAttack10)
                for k, v in pairs(ac.animator.anims.basic) do
                    v:Play(0.01, 0.01, 0.01)
                end                 
                if game.Players.LocalPlayer.Character:FindFirstChildOfClass("Tool") and ac.blades and ac.blades[1] then 
                    game:GetService("ReplicatedStorage").RigControllerEvent:FireServer("weaponChange", tostring(CurrentWeapon()))
                    game.ReplicatedStorage.Remotes.Validator:FireServer(math.floor(NumberAc12 / 1099511627776 * 16777215), AcAttack10)
                    game:GetService("ReplicatedStorage").RigControllerEvent:FireServer("hit", bladehit, 2, "") 
                end
            end
        end
    end
end

-- Criar um Frame para conter os botões
local frame = Instance.new("Frame")
frame.Name = "AutoFarmControls"
frame.Size = UDim2.new(0, 200, 0, 50)
frame.Position = UDim2.new(0.5, -100, 0.1, 0)
frame.BackgroundTransparency = 0.5
frame.BackgroundColor3 = Color3.fromRGB(0, 0, 0)
frame.Parent = game:GetService("Players").LocalPlayer.PlayerGui

-- Criar um botão para ativar o AutoFarm
local enableButton = Instance.new("TextButton")
enableButton.Name = "EnableButton"
enableButton.Size = UDim2.new(0, 90, 0, 40)
enableButton.Position = UDim2.new(0.05, 0, 0.5, -20)
enableButton.Text = "Ativar AutoFarm"
enableButton.BackgroundColor3 = Color3.fromRGB(0, 255, 0)
enableButton.Parent = frame

-- Criar um botão para desativar o AutoFarm
local disableButton = Instance.new("TextButton")
disableButton.Name = "DisableButton"
disableButton.Size = UDim2.new(0, 90, 0, 40)
disableButton.Position = UDim2.new(0.5, 10, 0.5, -20)
disableButton.Text = "Desativar AutoFarm"
disableButton.BackgroundColor3 = Color3.fromRGB(255, 0, 0)
disableButton.Parent = frame

-- Função para ativar o AutoFarm
local function EnableAutoFarm()
    _G.AutoFarm = true
    print("AutoFarm ativado")
end

-- Função para desativar o AutoFarm
local function DisableAutoFarm()
    _G.AutoFarm = false
    print("AutoFarm desativado")
end

-- Conectar os botões aos eventos de clique
enableButton.MouseButton1Click:Connect(EnableAutoFarm)
disableButton.MouseButton1Click:Connect(DisableAutoFarm)

-- Loop para executar o AutoFarm enquanto estiver ativado
while true do
    if _G.AutoFarm then
        AttackFunction()
    end
    wait() -- Aguardar um pouco antes de verificar novamente
end
