local Players = game:GetService("Players")
local LocalPlayer = Players.LocalPlayer

local ESPEnabled = true -- Definindo ESP como ativado por padrão

-- Velocidade do jogador (ajuste conforme necessário)
local PlayerSpeed = 50

-- Função para verificar se um ponto é visível
local function IsPointVisible(Point)
    local Camera = workspace.CurrentCamera
    if Camera then
        local Ray = Ray.new(Camera.CFrame.Position, (Point - Camera.CFrame.Position).unit * 1000)
        local _, Position = workspace:FindPartOnRayWithIgnoreList(Ray, {LocalPlayer.Character}, false, true)
        return Position == nil or (Position - Point).Magnitude < 0.01
    end
    return false
end

-- Função para mirar no alvo
local function AimAtTarget(Player)
    local TargetCharacter = Player.Character
    if TargetCharacter then
        local TargetHumanoidRootPart = TargetCharacter:FindFirstChild("HumanoidRootPart")
        if TargetHumanoidRootPart then
            local TargetPosition = TargetHumanoidRootPart.Position
            if IsPointVisible(TargetPosition) then
                local Camera = workspace.CurrentCamera
                if Camera then
                    local Ray = Ray.new(Camera.CFrame.Position, (TargetPosition - Camera.CFrame.Position).unit * 1000)
                    local _, Position = workspace:FindPartOnRayWithIgnoreList(Ray, {LocalPlayer.Character}, false, true)
                    if Position then
                        Camera.CFrame = CFrame.new(Camera.CFrame.Position, Position)
                    end
                end
            end
        end
    end
end

-- Função para ajustar a velocidade do jogador
local function SetPlayerSpeed(speed)
    local character = LocalPlayer.Character
    if character then
        local humanoid = character:FindFirstChildOfClass("Humanoid")
        if humanoid then
            humanoid.WalkSpeed = speed
        end
    end
end

-- Função para desativar ESP
local function DisableESP()
    for _, Player in pairs(Players:GetPlayers()) do
        if Player.Character then
            for _, obj in pairs(Player.Character:GetChildren()) do
                if obj:IsA("BoxHandleAdornment") or obj:IsA("BillboardGui") then
                    obj:Destroy()
                end
            end
        end
    end
end

-- Função para verificar se um objeto é um jogador válido
local function IsPlayer(Player)
    return Player.Name ~= "" and Player.Character ~= nil
end

-- Função para atualizar ESP
local function UpdateESP()
    for _, Player in pairs(Players:GetPlayers()) do
        if IsPlayer(Player) then
            DrawBoxESP(Player)
            DrawNameESP(Player)
        end
    end
end

-- Função para o AimBot
local function AimBot()
    while true do
        for _, Player in pairs(Players:GetPlayers()) do
            if IsPlayer(Player) and Player.TeamColor ~= LocalPlayer.TeamColor then
                AimAtTarget(Player)
            end
        end
        wait() -- Adiciona um pequeno atraso para não sobrecarregar o sistema
    end
end

-- Conectar eventos de entrada de jogador
Players.PlayerAdded:Connect(function(Player)
    UpdateESP()
end)

Players.PlayerRemoving:Connect(function(Player)
    if IsPlayer(Player) then
        DisableESP()
    end
end)

-- Ativar ESP ao iniciar o script
if ESPEnabled then
    UpdateESP()
end

-- Ajustar velocidade do jogador
SetPlayerSpeed(PlayerSpeed)

-- Iniciar AimBot
AimBot()
