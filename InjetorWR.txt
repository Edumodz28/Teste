local Players = game:GetService("Players")
local RunService = game:GetService("RunService")
local ReplicatedStorage = game:GetService("ReplicatedStorage")
local Lib = loadstring(game:HttpGet("https://raw.githubusercontent.com/7yhx/kwargs_Ui_Library/main/source.lua"))()

local UI = Lib:Create{
    Theme = "Dark",
    Size = UDim2.new(0, 1, 0, 1)
}

local function createESP(player)
    local Box = Instance.new("BoxHandleAdornment")
    Box.Size = player.Character.HumanoidRootPart.Size + Vector3.new(0.1, 0.1, 0.1)
    Box.Adornee = player.Character.HumanoidRootPart
    Box.AlwaysOnTop = true
    Box.ZIndex = 5
    Box.Transparency = 0.5
    Box.Color3 = Color3.new(1, 0, 0)
    Box.Parent = player.Character.HumanoidRootPart

    local Line = Instance.new("LineHandleAdornment")
    Line.Adornee = player.Character.HumanoidRootPart
    Line.AlwaysOnTop = true
    Line.Transparency = 0.5
    Line.Color3 = Color3.new(1, 0, 0)
    Line.ZIndex = 5
    Line.Thickness = 2
    Line.Parent = player.Character.HumanoidRootPart

    RunService.RenderStepped:Connect(function()
        if player.Character and player.Character:FindFirstChild("HumanoidRootPart") then
            Box.Size = player.Character.HumanoidRootPart.Size + Vector3.new(0.1, 0.1, 0.1)
            Box.CFrame = player.Character.HumanoidRootPart.CFrame

            local screenPosition, onScreen = workspace.CurrentCamera:WorldToScreenPoint(player.Character.HumanoidRootPart.Position)
            if onScreen then
                Line.From = Vector3.new(screenPosition.X, screenPosition.Y, 0)
                Line.To = Vector3.new(workspace.CurrentCamera.ViewportSize.X / 2, workspace.CurrentCamera.ViewportSize.Y, 0)
            else
                Line.From = Vector3.new(0, workspace.CurrentCamera.ViewportSize.Y, 0)
                Line.To = Vector3.new(0, workspace.CurrentCamera.ViewportSize.Y, 0)
            end
        else
            Box:Destroy()
            Line:Destroy()
        end
    end)
end

Players.PlayerAdded:Connect(function(player)
    createESP(player)
end)

Players.PlayerRemoving:Connect(function(player)
    local character = player.Character
    if character then
        local humanoidRootPart = character:FindFirstChild("HumanoidRootPart")
        if humanoidRootPart then
            humanoidRootPart:FindFirstChildOfClass("BoxHandleAdornment"):Destroy()
            humanoidRootPart:FindFirstChildOfClass("LineHandleAdornment"):Destroy()
        end
    end
end)
