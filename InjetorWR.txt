local Players = game:GetService("Players")
local LocalPlayer = Players.LocalPlayer

local ESPEnabled = true -- Definindo ESP como ativado por padrão
local AimEnabled = true -- Definindo a mira como ativada por padrão

-- Velocidade do jogador (ajuste conforme necessário)
local PlayerSpeed = 50

local function ESP(Player)
    local LocalPlayerTeam = LocalPlayer.Team
    local PlayerTeam = Player.Team
    if LocalPlayerTeam and PlayerTeam and LocalPlayerTeam ~= PlayerTeam then
        local Box = Instance.new("BoxHandleAdornment")
        Box.Size = Player.Character.HumanoidRootPart.Size + Vector3.new(0.1, 0.1, 0.1)
        Box.Adornee = Player.Character.HumanoidRootPart
        Box.AlwaysOnTop = true
        Box.ZIndex = 5
        Box.Transparency = 0.5
        Box.Color3 = Color3.new(1, 0, 0)
        Box.Parent = Player.Character.HumanoidRootPart
    end
end

local function SetPlayerSpeed(speed)
    local character = LocalPlayer.Character
    if character then
        local humanoid = character:FindFirstChildOfClass("Humanoid")
        if humanoid then
            humanoid.WalkSpeed = speed
        end
    end
end

local function DisableESP()
    for _, Player in pairs(Players:GetPlayers()) do
        if Player.Character and Player.Character:FindFirstChild("HumanoidRootPart") then
            local espAdornment = Player.Character.HumanoidRootPart:FindFirstChildOfClass("BoxHandleAdornment")
            if espAdornment then
                espAdornment:Destroy()
            end
        end
    end
end

local function IsPlayer(Player)
    return Player.Name ~= ""
end

local function UpdateESP()
    if not ESPEnabled then
        DisableESP()
        return
    end
    for _, Player in pairs(Players:GetPlayers()) do
        if IsPlayer(Player) then
            ESP(Player)
        end
    end
end

local function AimAtTarget(Player)
    if not AimEnabled then
        return
    end
    local camera = workspace.CurrentCamera
    if camera then
        local targetCharacter = Player.Character
        if targetCharacter then
            local targetHumanoidRootPart = targetCharacter:FindFirstChild("HumanoidRootPart")
            if targetHumanoidRootPart then
                local ray = Ray.new(camera.CFrame.Position, (targetHumanoidRootPart.Position - camera.CFrame.Position).unit * 1000)
                local part, hitPos = workspace:FindPartOnRay(ray, LocalPlayer.Character, false, true)
                if part and part:IsDescendantOf(targetCharacter) then
                    if part.Transparency == 0 and Player.TeamColor ~= LocalPlayer.TeamColor then
                        camera.CFrame = CFrame.new(camera.CFrame.Position, hitPos)
                    end
                end
            end
        end
    end
end

local function ToggleESP()
    ESPEnabled = not ESPEnabled
    UpdateESP()
end

local function ToggleAim()
    AimEnabled = not AimEnabled
end

local function SetPlayerSpeed(speed)
    local character = LocalPlayer.Character
    if character then
        local humanoid = character:FindFirstChildOfClass("Humanoid")
        if humanoid then
            humanoid.WalkSpeed = speed
        end
    end
end

-- Ativando ESP ao iniciar o script
UpdateESP()

-- Ajustando a velocidade do jogador
SetPlayerSpeed(PlayerSpeed)

-- Criando um menu simples para ativar/desativar a ESP e a mira automática
local menu = Instance.new("ScreenGui")
menu.Parent = game.Players.LocalPlayer.PlayerGui

local frame = Instance.new("Frame")
frame.Size = UDim2.new(0, 100, 0, 60)
frame.Position = UDim2.new(0, 10, 0, 10)
frame.BackgroundColor3 = Color3.new(0.2, 0.2, 0.2)
frame.BorderSizePixel = 2
frame.Parent = menu

local espButton = Instance.new("TextButton")
espButton.Text = "ESP: On"
espButton.Size = UDim2.new(0, 80, 0, 25)
espButton.Position = UDim2.new(0, 10, 0, 10)
espButton.BackgroundColor3 = Color3.new(0.4, 0.4, 0.4)
espButton.BorderSizePixel = 2
espButton.Parent = frame
espButton.MouseButton1Click:Connect(ToggleESP)

local aimButton = Instance.new("TextButton")
aimButton.Text = "Aim: On"
aimButton.Size = UDim2.new(0, 80, 0, 25)
aimButton.Position = UDim2.new(0, 10, 0, 35)
aimButton.BackgroundColor3 = Color3.new(0.4, 0.4, 0.4)
aimButton.BorderSizePixel = 2
aimButton.Parent = frame
aimButton.MouseButton1Click:Connect(ToggleAim)
